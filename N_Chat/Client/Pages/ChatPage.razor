@inject IChatService ChatService
@inject IUserService UserService
@page "/ChatPage"


<h3>ChatPage</h3>
<EditForm Model="@Chat" OnSubmit="HandleSubmit">
    <MudTextField @bind-Value="@Chat.Name" placeholder="Chat name"></MudTextField>
    <MudTextField @bind-Value="@_userName" placeholder="UserToAdd"></MudTextField>
    <MudButton ButtonType="ButtonType.Submit" Color="Color.Primary" Variant="Variant.Outlined">Submit</MudButton>
</EditForm>
@code {
    ChatModel Chat { get; set; } = new();
    UserModel User { get; set; } = new();
    List<ChatModel> Chats { get; set; } = new();
    UserModel UserToAdd { get; set; } = new();
    private string _userName;
    private async Task HandleSubmit(EditContext context)
    {
        var getuser = await UserService.GetUserClaim();
        var userToAdd = await UserService.GetUserByName(_userName);
        if (getuser.Message == "Success")
        {
            User = getuser.user;
            if (User != null)
            {
                Chat.ChatCreated = DateTime.Now;
                Chat.UserName = User.UserName;
                Chat.CreatorId = User.Id;
                Chat.Users = new List<UserModel>()
                {
                    userToAdd,
                };
                await ChatService.CreateChat(Chat);
            }
            
        }
    }
}